<html>
  <script>
  
    chrome.extension.onRequest.addListener(handleRequest);
  
    function handleRequest(index, sender, sendResponse) {
      sendResponse(); // Close connection.

      withBookmarksBar(function(bar) {
        var item = bar.children[index-1];
        if (item && item.url) {
          chrome.tabs.update(sender.tab.id, { url: item.url });
        }
      });
    }


    function withBookmarksBar(callback) {
      chrome.bookmarks.getTree(function(array) {
        var bookmarks_bar = array[0].children[0];  // Is this guaranteed?
        callback(bookmarks_bar);
      });
    }

  </script>
</html>
